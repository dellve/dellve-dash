<!-- Component Control-->
<script>
// 1. Setup Poll handler for benchmark progress updates
$request = new PollRequest();

// Use progress proxy to access cross origin resource
function PollRequest() {
  this.pollTimer = null;
  this.interval = 1000; // Request benchmark progress every second
  this.url = '/progress-proxy?url_base={{server}}:{{dellve_port}}';
}

// Disable long poll when benchmark run inactive ( no need to poll dellve indefinitely )
PollRequest.prototype.deactivatePoll = function () {
  clearInterval(this.pollTimer);
  this.pollTimer = null;
};

// Long poll dellve server for progress updates on currently running benchmark
PollRequest.prototype.activatePoll = function () {
  this.pollTimer = setInterval(() => {
    $.getJSON(this.url, function(runDetail) {
        console.log('Benchmark Progress:' + runDetail['progress']);
        $('#benchmark-progress').attr('aria-valuenow', runDetail['progress']).css('width',runDetail['progress'] + "%");
        // Benchmark run complete, end polling, change stop to start button,
        if ( runDetail['progress'] == 100 ) {
            console.log('Benchmark run complete');
            var controlButton = document.getElementById('benchmark-start-stop');
            controlButton.value = 'Start';
            controlButton.className = 'btn btn-info';
            $request.deactivatePoll();
            // TODO: populate benchmark detail
            $('#benchmark-detail').attr('aria-expanded', true); // expand detail panel

        }
    })
  }, this.interval);
};

// 2. Initialize proper run panel configuration
// User may have left benchmark page in middle of benchmark run
// if benchmark is still running, restore stop button and proper progress bar value
// elsewise, restore previous benchmark results (if there are any)
{% if run_detail['progress'] != 0 and run_detail['progress'] != 100 %}
$request.activatePoll();
{% endif %}

</script>

<!-- Component View -->
<!-- TODO: Fix styling; BEGIN BENCHMARK RUN DETAIL PANEL -->
<div id="accordion2" class='panel panel-default accordion-group' style='width:91%;'>
    <div class='panel-heading' style='height: 55px; position:relative'>
        <a class='accordion-toggle'  data-toggle="collapse"  data-parent="#accordion2" href="#benchmark-detail">
            <div class="row">
                <div class='col-xs-6' style='align: left;'>
                    <h4 class='panel-title'>Run Detail</h4>
                </div>
                <div class='col-xs-6' style='align: right'>
                    <div class="progress">
                        <div id='benchmark-progress' class="progress-bar progress-bar-success progress-bar-striped"
                            role="progressbar" aria-valuenow="{{ run_detail['progress'] }}"
                            aria-valuemin="0" aria-valuemax="100" style="width:{{ run_detail['progress'] }}%; margin-bottom:-50%"
                            value="{{ run_detail['progress'] }}%">
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <!-- TODO: Insert Detail panel specs-->
    <div id="benchmark-detail" aria-expanded='false' class="collapse in panel-body">
            Blah Blah example detail
    </div>
</div>
<!-- END BENCHMARK DETAIL PANEL -->
