<!-- Component Control-->
<script>
// 1. Setup Poll handler for benchmark progress updates
$request = new PollRequest();

// Use progress proxy to access cross origin resource
function PollRequest() {
  this.pollTimer = null;
  this.interval = 1000; // Request benchmark progress every second
  this.url = '/progress-proxy?url_base={{server}}:{{dellve_port}}';
}

// Disable long poll when benchmark run inactive
// Currently not in use
PollRequest.prototype.deactivatePoll = function () {
  clearInterval(this.pollTimer);
  this.pollTimer = null;
};

// Long poll dellve server for progress updates on currently running benchmark
PollRequest.prototype.activatePoll = function () {
  this.pollTimer = setInterval(() => {
    $.getJSON(this.url, function(runDetail) {
        var controlButton = document.getElementById('benchmark-start-stop');
        // select benchmark dropdown value to currently running/last run benchmark
        document.getElementById('run-detail-heading').innerHTML = 'Run Detail: Benchmark' + runDetail['id'];
        $('#benchmark-progress').attr('aria-valuenow', runDetail['progress']).css('width',runDetail['progress'] + "%");

        if ( runDetail['progress'] == 100 ) {
            controlButton.value = 'Start';
            controlButton.className = 'btn btn-info';
            // TODO: populate benchmark detail
            $('#benchmark-detail').attr('aria-expanded', true); // expand detail panel
            document.getElementById('benchmark-progress').className = 'progress-bar progress-bar-success progress-bar-striped';
            document.getElementById('benchmark-progress').innerHTML = "Complete";
        // TODO: disable stop if user is not benchmark run owner
        } else if ( runDetail['running'] == true ) {
            document.getElementById('benchmark-container').value = runDetail['id'] // Default dropdown to currently currently running benchmark
            document.getElementById('run-detail-heading').innerHTML = 'Run Detail: Benchmark' + runDetail['id'];
            document.getElementById('benchmark-progress').innerHTML = runDetail['progress'] + "%";
            controlButton.value = 'Stop';
            controlButton.className = 'btn btn-warning';
            document.getElementById('benchmark-progress').className = 'progress-bar progress-bar-info progress-bar-striped';
        // Benchmark stopped
        } else {
            controlButton.value = 'Start';
            controlButton.className = 'btn btn-info';
            document.getElementById('benchmark-progress').className = 'progress-bar progress-bar-warning progress-bar-striped';
            document.getElementById('benchmark-progress').innerHTML = 'Stopped';
        }

    })
  }, this.interval);
};

$request.activatePoll();

</script>



<!-- Component View -->
<!-- TODO: Fix styling;
BEGIN BENCHMARK RUN DETAIL PANEL -->
<div id="accordion2" class='panel panel-default accordion-group' style='width:91%;'>
    <div class='panel-heading' style='height: 55px; position:relative'>
        <a class='accordion-toggle'  data-toggle="collapse"  data-parent="#accordion2" href="#benchmark-detail">
            <div class="row">
                <div class='col-xs-6' style='align: left;'>
                    <h4 id= 'run-detail-heading' class='panel-title'>Run Detail: </h4>
                </div>
                <div class='col-xs-6' style='align: right'>
                    <div class="progress">
                        <!-- TODO: initialize progress bar colour with respect to benchmark state
                            TODO: add value and state label-->
                        <div id='benchmark-progress' class="progress-bar progress-bar-info progress-bar-striped"
                            role="progressbar" aria-valuenow="{{ run_detail['progress'] }}"
                            aria-valuemin="0" aria-valuemax="100" style="width:{{ run_detail['progress'] }}%; margin-bottom:-50%; min-width: 2em;"
                            value="{{ run_detail['progress'] }}%"> {{ run_detail['progress'] }} %
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <!-- TODO: Insert Detail panel specs-->
    <div id="benchmark-detail" aria-expanded='false' class="collapse in panel-body">

    </div>
</div>
<!-- END BENCHMARK DETAIL PANEL -->
